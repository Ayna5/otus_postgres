# Домашнее задание
## Репликация

1. На 1 ВМ создаем таблицы test для записи, test2 для запросов на чтение.

```sql
CREATE TABLE test as select generate_series(1, 100) as id, md5(random()::text)::char(10) as fio;
CREATE TABLE test2 (id serial, fio varchar(10));
```

<img width="1338" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/f863075a-8fb2-4926-abb9-dcef352739c2">
<img width="768" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/f5da5348-6b77-4f7f-b46f-f95485db5164">

2. Создаем публикацию таблицы test и подписываемся на публикацию таблицы test2 с ВМ №2.

```
-- выставим wal_level на уровень logical 
ALTER SYSTEM SET wal_level = logical;

-- рестарт, чтобы применить изменения 
sudo systemctl restart postgresql@15-main

show wal_level;

-- создаем публикацию таблицы test
CREATE PUBLICATION test_publication_vm1 FOR TABLE test;

-- подписываемся на публикацию таблицы test2 vm2
CREATE SUBSCRIPTION test2_subscription_vm2 CONNECTION 'host=158.160.144.175 user=postgres dbname=postgres password=123' PUBLICATION test2_publication_vm2 WITH (copy_data = TRUE);

# vm2
host    postgres        postgres        158.160.143.208/32         trust

host    all             all             158.160.143.208/32      scram-sha-256

host    replication     all             158.160.144.175/32      scram-sha-256
host    replication     all             158.160.157.145/32      scram-sha-256
host    postgres        postgres        192.168.0.5/16          trust
host    postgres        postgres        192.168.0.0/16          trust

host    replication     all             158.160.157.145/16      scram-sha-256

host    postgres        postgres        158.160.144.175/32         trust

host    postgres        postgres        158.160.157.145/32         trust

psql -h 158.160.144.175 -p 5432 -d postgres -U postgres -W
psql -h 192.168.0.5 -p 5432 -d postgres -U postgres -W

sudo nano /etc/postgresql/15/main/pg_hba.conf

sudo nano /etc/postgresql/15/main/postgresql.conf
```

<img width="477" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/e4c131cd-0cd0-409a-8507-4a29cf98034c">



