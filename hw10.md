# Домашнее задание
## Репликация

1. На 1 ВМ создаем таблицы test для записи, test2 для запросов на чтение.

```sql
CREATE TABLE test as select generate_series(1, 100) as id, md5(random()::text)::char(10) as fio;
CREATE TABLE test2 (id serial, fio varchar(10));
```

<img width="1338" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/f863075a-8fb2-4926-abb9-dcef352739c2">
<img width="768" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/f5da5348-6b77-4f7f-b46f-f95485db5164">

2. Создаем публикацию таблицы test и подписываемся на публикацию таблицы test2 с ВМ №2.

```
-- выставим wal_level на уровень logical 
ALTER SYSTEM SET wal_level = logical;

-- рестарт, чтобы применить изменения 
sudo systemctl restart postgresql@15-main

show wal_level;

-- создаем публикацию таблицы test
CREATE PUBLICATION test_publication_vm1 FOR TABLE test;

-- подписываемся на публикацию таблицы test2 vm2
CREATE SUBSCRIPTION test2_subscription_vm2 CONNECTION 'host=158.160.157.240 user=postgres dbname=postgres password=123' PUBLICATION test2_publication_vm2 WITH (copy_data = TRUE);

# vm1
sudo nano /etc/postgresql/15/main/pg_hba.conf -> host    replication     all             158.160.157.240/32      scram-sha-256
sudo nano /etc/postgresql/15/main/postgresql.conf -> listen_addresses = '*'

# vm2
sudo nano /etc/postgresql/15/main/pg_hba.conf -> host    replication     all             158.160.160.244/32      scram-sha-256
sudo nano /etc/postgresql/15/main/postgresql.conf -> listen_addresses = '*'

-- проверяем что данные в таблице test есть
select * from test limit 10;

-- статус подписки
SELECT * FROM pg_stat_subscription\gx
```

<img width="477" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/e4c131cd-0cd0-409a-8507-4a29cf98034c">
<img width="664" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/48844535-493a-44a2-b3d0-61874cba6d97">
<img width="687" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/d44d18ed-d1b5-4738-b416-6ca23b836587">
<img width="1333" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/20769cc9-f2a4-4675-b8cf-e718d7ad2cdb">
<img width="345" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/6ee72b4a-fa87-4cf8-80e5-7d59d1b66508">
<img width="439" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/d975ba7c-5609-4294-85c3-6d251e254a8a">





