# Домашнее задание
## Репликация

1. На 1 ВМ создаем таблицы test для записи, test2 для запросов на чтение.

```sql
CREATE TABLE test as select generate_series(1, 100) as id, md5(random()::text)::char(10) as fio;
CREATE TABLE test2 (id serial, fio varchar(10));
```

<img width="1331" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/4c92ec70-b010-460d-9423-ef1348b634c8">
<img width="767" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/c1189560-cb49-4425-993f-ad32939b6227">

2. Создаем публикацию таблицы test и подписываемся на публикацию таблицы test2 с ВМ №2.

```
-- выставим wal_level на уровень logical 
ALTER SYSTEM SET wal_level = logical;

-- рестарт, чтобы применить изменения 
sudo systemctl restart postgresql@15-main

show wal_level;

-- создаем публикацию таблицы test
CREATE PUBLICATION test_publication_otus_vm FOR TABLE test;

-- подписываемся на публикацию таблицы test2 otus-vm2
CREATE SUBSCRIPTION test2_subscription_otus_vm2 CONNECTION 'host=158.160.157.110 user=postgres dbname=postgres password=123' PUBLICATION test2_publication_otus_vm2 WITH (copy_data = TRUE);

# vm2
host    postgres        postgres        158.160.157.110/32         trust
```

<img width="402" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/afdaaab0-1e3e-488e-8cf9-9b823550c7be">
<img width="480" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/cfbdbfb7-ca53-47fc-af69-96532520198c">
<img width="519" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/810e7623-62a2-400d-bc6c-5aa97f882210">


