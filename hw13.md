# Домашнее задание
## Секционирование таблицы

### Подготовка
```
wget https://edu.postgrespro.ru/demo-big.zip && sudo apt install unzip && unzip demo-big.zip
sudo -u postgres psql < /home/postgres/demo-big-20170815.sql
```

<img width="626" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/a2c68eac-e433-4605-aa59-72a2b769616a">
<img width="608" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/89d90abb-5146-47a0-af53-0373874360ea">

### Секционирование по хешу
```sql
-- создадим отдельную схему
CREATE SCHEMA IF NOT EXISTS by_hash;

-- создадим таблицу
CREATE TABLE by_hash.flights (
	flight_id serial4 NOT NULL,
	flight_no bpchar(6) NOT NULL,
	scheduled_departure timestamptz NOT NULL,
	scheduled_arrival timestamptz NOT NULL,
	departure_airport bpchar(3) NOT NULL,
	arrival_airport bpchar(3) NOT NULL,
	status varchar(20) NOT NULL,
	aircraft_code bpchar(3) NOT NULL,
	actual_departure timestamptz NULL,
	actual_arrival timestamptz NULL
) PARTITION BY hash (flight_id);

-- создадим таблицы-партиции, в количестве 5 шт
CREATE TABLE by_hash.flights_0 partition of by_hash.flights for values with (modulus 5, remainder 0);
CREATE TABLE by_hash.flights_1 partition of by_hash.flights for values with (modulus 5, remainder 1);
CREATE TABLE by_hash.flights_2 partition of by_hash.flights for values with (modulus 5, remainder 2);
CREATE TABLE by_hash.flights_3 partition of by_hash.flights for values with (modulus 5, remainder 3);
CREATE TABLE by_hash.flights_4 partition of by_hash.flights for values with (modulus 5, remainder 4);

-- наполняем дочернюю таблицу
INSERT INTO by_hash.flights
SELECT * FROM bookings.flights;

-- запрос к родительской таблице
explain select * from bookings.flights where flight_id = 1000;

-- запрос к дочерней таблице - планировщик распредил нас на партицию #4, таблицу flights_4
explain select * from by_hash.flights where flight_id = 1000;
```

<img width="1246" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/3d3b2fda-da60-4b70-8b89-e1c8309a1f2a">
<img width="797" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/d9f2f80e-b680-4d21-8191-fef3c7dc3b8d">
<img width="575" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/79ccbc01-1763-4427-b5db-ab015901e159">
<img width="521" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/4750fa0c-ae83-4ac6-bd44-64f2de5ae92e">


