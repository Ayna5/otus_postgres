# Домашнее задание
## Работа с журналами

1. Настройте выполнение контрольной точки раз в 30 секунд.
```
psql
alter system set checkpoint_timeout = '30s';
select pg_current_wal_insert_lsn();
```

<img width="416" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/b068e606-12d5-4731-9e88-a4654e4cf898">
<img width="340" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/a7decdda-45cd-4572-a19d-97df426cb383">

2. 10 минут c помощью утилиты pgbench подавайте нагрузку
```
pgbench -i postgres
pgbench -c 8 -P 6 -T 600 -U postgres postgres
```

<img width="524" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/2e364874-395f-47eb-9bec-4b1d3d359ed4">
<img width="504" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/633ad04d-0756-4dd4-b5f4-adae703481a7">
<img width="501" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/e6863dab-216b-4486-99cf-104e4db293e6">

3. Измерьте, какой объем журнальных файлов был сгенерирован за это время. Оцените, какой объем приходится в среднем на одну контрольную точку.

```sql
select pg_current_wal_insert_lsn();
```

<img width="388" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/4eed42f4-7c7d-46f9-9405-874888ca1e30">

```sql
select pg_size_pretty('0/FFF65F0'::pg_lsn - '0/21C5B38'::pg_lsn);
```

<img width="578" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/ce92a87d-d4ab-4b92-baab-5db233bee4b3">

```
show data_directory;
\q
sudo ls -lh /var/lib/postgresql/15/main/pg_wal | sort -d
```

<img width="611" alt="image" src="https://github.com/Ayna5/otus_postgres/assets/42717899/6f8c7ec3-8f57-4b0e-af91-e98b3fd153b5">

Получилось 13 архивов по 16 Мб, общий размер составил 208 Мб.
Получается на каждую контрольную точку приходилось 10.4 Мб (208 Мб / (600 с / 30 с))
